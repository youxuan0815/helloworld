# 更新後的PRD：右側圓形觸控方向控制面板

## 功能名稱
**右側圓形觸控方向控制面板**（替代現有底部按鈕組）

## 為什麼要加
1. **改善移動設備操作體驗**：將控制面板移至右側，避免手指遮擋遊戲畫面
2. **簡化界面**：用單一的圓形觸控面板取代分散的四個按鈕，更美觀簡約
3. **提升遊戲可玩性**：更符合人體工學的單手操作位置，特別適合手機和平板用戶

## 具體要求

### 1. 功能設計（已明確）
- **完全取代**現有的底部移動控制按鈕組（`.mobile-controls`）
- 在遊戲畫面**右側**添加一個**圓形觸控面板**
- 交互方式為**點擊上下左右四個方向區域**
- 支持**觸控反饋**（視覺變化）

### 2. 視覺設計（由我定義 - 簡約美觀風格）
- **位置**：固定在遊戲畫布右側，垂直居中
- **形狀**：圓形設計，內部劃分為四個扇形區域（上、下、左、右）
- **尺寸**：
  - 移動端：直徑約為畫布高度的40-50%
  - 桌面端：可選顯示，直徑適中
- **顏色方案**：
  - 背景：半透明深色（rgba(30, 30, 40, 0.7)）
  - 邊框：細亮色邊框（#4dff91，與遊戲主題色一致）
  - 方向區域默認狀態：微透明
  - 方向區域激活狀態：高亮顯示（#4dff91帶透明度）
- **視覺反饋**：
  - 點擊時：對應方向區域顏色變亮，有輕微縮放效果
  - 持續按住：保持高亮狀態
  - 釋放時：平滑過渡回默認狀態
- **方向指示**：
  - 使用簡約箭頭圖標或三角形指示方向
  - 圖標顏色為淺色，與背景對比明顯

### 3. 交互邏輯
- **點擊操作**：點擊四個扇形區域中的任一個，立即改變蛇的方向
- **方向限制**：保持現有邏輯，防止180度急轉
- **觸控響應**：立即響應，無明顯延遲
- **與鍵盤控制兼容**：觸控和鍵盤輸入可以同時存在，但觸控操作優先更新`nextDirection`

### 4. 響應式設計
- **手機端（寬度≤768px）**：
  - 顯示圓形觸控面板
  - 面板位置：緊貼遊戲畫布右側，垂直居中
  - 隱藏原有的底部`.mobile-controls`
  
- **平板端（寬度769px-1024px）**：
  - 根據屏幕方向調整面板大小
  - 橫屏時面板稍大，豎屏時與手機端類似
  
- **桌面端（寬度>1024px）**：
  - **默認隱藏**觸控面板（桌面用戶主要使用鍵盤）
  - 可添加一個小按鈕/開關來顯示/隱藏觸控面板（為觸摸屏設備準備）

### 5. 技術實現要點
- 移除現有的`.mobile-controls`相關CSS和HTML
- 創建新的觸控面板組件
- 使用CSS圓形和漸變實現視覺效果
- 使用JavaScript處理觸控事件
- 與現有的`nextDirection`系統集成

### 6. 需要解決的技術問題

#### 6.1 圓形區域點擊檢測
```javascript
// 需要計算點擊點相對於圓心的角度
function getTouchDirection(touchX, touchY, centerX, centerY) {
  const angle = Math.atan2(touchY - centerY, touchX - centerX) * 180 / Math.PI;
  // 根據角度判斷點擊了哪個扇形區域
}
```

#### 6.2 響應式位置計算
- 面板需要根據畫布大小和位置動態計算
- 考慮畫布可能因響應式調整而改變尺寸

#### 6.3 視覺狀態管理
- 需要管理四個方向區域的激活/非激活狀態
- 實現平滑的過渡動畫

### 7. 詳細視覺規格

#### 7.1 圓形面板結構
```
           [上: 45°-135°]
[左: 135°-225°]    ○    [右: -45°-45°]
           [下: 225°-315°]
```

#### 7.2 顏色定義
- **面板背景**：`rgba(30, 30, 40, 0.7)`
- **面板邊框**：`2px solid rgba(77, 255, 145, 0.5)`
- **面板陰影**：`0 4px 20px rgba(0, 0, 0, 0.3)`
- **默認方向區域**：`rgba(255, 255, 255, 0.1)`
- **激活方向區域**：`rgba(77, 255, 145, 0.3)`
- **箭頭圖標**：`#ffffff`

#### 7.3 動畫效果
- **激活動畫**：0.1秒的背景色變化 + 輕微縮放（scale: 1.05）
- **釋放動畫**：0.2秒的平滑過渡
- **箭頭脈衝效果**：輕微的呼吸動畫（可選）

### 8. 與現有系統的集成

#### 8.1 移除的部分
- 刪除`.mobile-controls`相關的HTML結構
- 刪除對應的CSS樣式
- 移除移動按鈕的事件監聽器

#### 8.2 添加的部分
```html
<div class="touch-control-panel">
  <div class="touch-area">
    <div class="direction up" data-direction="up">↑</div>
    <div class="direction left" data-direction="left">←</div>
    <div class="direction down" data-direction="down">↓</div>
    <div class="direction right" data-direction="right">→</div>
  </div>
</div>
```

#### 8.3 事件處理
```javascript
// 類似現有按鈕的處理邏輯
directionElement.addEventListener('touchstart', function(e) {
  const dir = this.dataset.direction;
  if (isValidDirectionChange(dir)) {
    nextDirection = dir;
    highlightDirection(dir); // 視覺反饋
  }
  e.preventDefault();
});
```

### 9. 測試要點

1. **觸控響應測試**
   - 各方向區域點擊準確性
   - 觸控反饋的及時性
   - 防止誤觸的邊界檢測

2. **視覺測試**
   - 不同屏幕尺寸下的顯示效果
   - 顏色對比度（確保可視性）
   - 動畫流暢度

3. **性能測試**
   - 觸控事件對遊戲性能的影響
   - 內存使用情況

### 10. 未來擴展可能性

1. **自定義設置**（未來版本）
   - 面板透明度調節
   - 面板大小調整
   - 位置切換（左/右側）
   - 振動反饋開關

2. **高級功能**（未來版本）
   - 滑動操作支持
   - 力度感應（滑動速度影響蛇的速度）
   - 多點觸控手勢

---
